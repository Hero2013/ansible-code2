---
- hosts: ws
become: yes
become_user: root
ignore_errors: yes
tasks:
  - name: Delete Old Artifacts
    file:
      path: /opt/qa/spg/*.jar
      state: absent

  - name: Get the PID
    shell: lsof -i :8082   
    register: pid_output

  - name: Kill Running App
    shell: kill -9 pid_output.stdout
    when: pid_output.stdout != ''  

  - name: Download New Artifact  
    get_url: http://100.25.23.179:8081/artifactory/geolocation/geo/bio_17.jar
      url:
      dest:
      url_username:
      url_password:

  - name: Run the App
      shell: nohup java -jar /opt/qa/spg/*.jar > /opt/qa/spg.log 2>&1 &
                 